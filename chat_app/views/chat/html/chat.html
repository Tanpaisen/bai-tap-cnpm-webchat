<!DOCTYPE html>
<html lang="vi" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evelyn Chat</title>
  
  <!-- 1. Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  
  <!-- 2. Config Theme -->
  <script src="/chat/js/configTheme.js"></script>

  <!-- 3. Fonts & Icons -->
   <link rel="stylesheet" href="/chat/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- 4. CSS Custom -->

</head>

<body class="bg-gray-50 text-gray-900 dark:bg-brand-bg dark:text-zinc-200 h-screen overflow-hidden selection:bg-brand-purple selection:text-white transition-colors duration-300">
  
  <div class="flex w-full h-full layout-3-col">
    
    <!-- 1. SIDEBAR TRÁI -->
    <nav class="sidebar-left w-20 bg-white dark:bg-brand-sidebar border-r border-gray-200 dark:border-brand-border flex flex-col items-center py-6 z-20 shadow-lg flex-shrink-0 transition-colors duration-300">
      <div id="avatar-box" class="mb-8 relative group cursor-pointer" title="Hồ sơ của bạn">
        <div class="absolute -inset-0.5 bg-gradient-to-r from-brand-purple to-blue-500 rounded-full opacity-75 blur group-hover:opacity-100 transition-opacity"></div>
        <img src="" id="profile-avatar" class="relative w-12 h-12 rounded-full object-cover border-2 border-white dark:border-brand-bg bg-gray-200 dark:bg-zinc-800">
      </div>
      
      <div class="menu-buttons flex flex-col gap-6 w-full items-center flex-1">
        <button data-func="chat" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-brand-purple dark:hover:text-white transition-all" title="Đoạn chat">
            <i class="fa-solid fa-comments text-xl"></i>
        </button>
        <button data-func="friends" id="btn-friends" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-brand-purple dark:hover:text-white transition-all" title="Bạn bè">
            <i class="fa-solid fa-users-rectangle text-xl"></i>
        </button>
        <button data-func="groups" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-brand-purple dark:hover:text-white transition-all" title="Nhóm chat">
            <i class="fa-solid fa-layer-group text-xl"></i>
        </button>
        <button data-func="profile" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:bg-blue-100 hover:text-blue-600 dark:hover:bg-brand-purple dark:hover:text-white transition-all" title="Hồ sơ">
            <i class="fa-solid fa-circle-user text-xl"></i>
        </button>
      </div>

      <div class="menu-settings flex flex-col gap-4 mt-auto">
        <button data-func="setting" class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-400 hover:bg-gray-200 dark:hover:bg-zinc-800 transition-all" title="Cài đặt">
            <i class="fa-solid fa-gear text-xl"></i>
        </button>
        <button id="logout-btn" class="w-10 h-10 rounded-xl flex items-center justify-center text-red-400 hover:bg-red-100 dark:hover:bg-red-500/10 transition-all" title="Đăng xuất">
            <i class="fa-solid fa-right-from-bracket text-xl"></i>
        </button>
      </div>
    </nav>

    <!-- 2. SIDEBAR GIỮA -->
    <aside class="sidebar-middle w-80 bg-white dark:bg-brand-panel border-r border-gray-200 dark:border-brand-border flex flex-col z-10 flex-shrink-0 relative transition-colors duration-300">
      
      <!-- A. Tab Chat -->
      <div id="list-chat" class="list-section active p-4 h-full">
        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 tracking-tight flex items-center gap-2"><i class="fa-brands fa-facebook-messenger text-blue-600 dark:text-brand-purple"></i> Đoạn chat</h3>
        <div class="search-box relative mb-4">
          <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input type="text" id="chat-search-input" placeholder="Tìm kiếm..." class="w-full bg-gray-100 dark:bg-brand-input text-sm text-gray-800 dark:text-white rounded-xl pl-10 pr-4 py-3 focus:ring-1 focus:ring-blue-500 dark:focus:ring-brand-purple focus:outline-none border border-gray-200 dark:border-brand-border placeholder-gray-500 transition-all">
        </div>
        <ul id="friend-list-chat" class="friend-list flex-1 overflow-y-auto space-y-1 pr-1 pb-4"></ul>
      </div>

      <!-- B. Tab Bạn bè -->
      <div id="list-friends" class="list-section p-4 h-full">
        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2"><i class="fa-solid fa-user-group text-blue-500"></i> Bạn bè</h3>
        <div class="relative mb-4">
           <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
           <input type="text" id="friend-search-input" placeholder="Tìm bạn bè..." class="w-full bg-gray-100 dark:bg-brand-input text-sm text-gray-800 dark:text-white rounded-xl pl-10 pr-4 py-3 focus:outline-none border border-gray-200 dark:border-brand-border">
        </div>
        <ul id="friend-menu" class="space-y-2">
          <li data-menu="friends" class="p-3 rounded-xl bg-gray-100 dark:bg-zinc-800 cursor-pointer text-sm font-medium text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-zinc-700 transition-all border border-transparent hover:border-gray-300 dark:hover:border-zinc-600">Danh sách bạn bè</li>
          <li data-menu="requests" class="p-3 rounded-xl bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border cursor-pointer text-sm font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-zinc-800 transition-all">Lời mời kết bạn</li>
          <li data-menu="all-user" class="p-3 rounded-xl bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border cursor-pointer text-sm font-medium text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-zinc-800 transition-all">Tìm bạn mới</li>
        </ul>
      </div>

      <!-- C. Tab Nhóm -->
      <div id="list-groups" class="list-section p-4 h-full">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2"><i class="fa-solid fa-layer-group text-green-500"></i> Nhóm</h3>
            <button onclick="document.getElementById('create-group-modal').style.display = 'flex'" class="w-8 h-8 bg-gray-200 dark:bg-zinc-800 rounded-full flex items-center justify-center text-gray-600 dark:text-zinc-400 hover:bg-brand-purple hover:text-white transition-all"><i class="fa-solid fa-plus"></i></button>
        </div>
        <div class="relative mb-4">
           <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
           <input type="text" placeholder="Tìm nhóm..." class="w-full bg-gray-100 dark:bg-brand-input text-sm text-gray-800 dark:text-white rounded-xl pl-10 pr-4 py-3 focus:outline-none border border-gray-200 dark:border-brand-border">
        </div>
        <ul id="group-list" class="friend-list flex-1 overflow-y-auto space-y-1 pr-1 pb-4">
            <li class="text-center text-xs text-gray-500 mt-4">Chưa tham gia nhóm nào</li>
        </ul>
      </div>

      <!-- D. Tab Cài đặt -->
      <div id="list-settings" class="list-section p-4 h-full">
        <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Cài đặt</h3>
        <ul id="settings-menu" class="space-y-2">
          <li data-menu="status" class="p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-zinc-800 cursor-pointer flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300"><i class="fa-solid fa-toggle-on w-5"></i> Trạng thái</li>
          <li data-menu="theme" class="p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-zinc-800 cursor-pointer flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300"><i class="fa-solid fa-palette w-5"></i> Giao diện</li>
          <li data-menu="messages" class="p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-zinc-800 cursor-pointer flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300"><i class="fa-solid fa-trash-can w-5"></i> Tin nhắn</li>
          <li data-menu="security" class="p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-zinc-800 cursor-pointer flex items-center gap-3 text-sm text-gray-700 dark:text-zinc-400"><i class="fa-solid fa-shield-halved w-5"></i> Bảo mật</li>
        </ul>
      </div>
    </aside>

    <!-- 3. MAIN CONTENT -->
    <main class="main-content flex-1 flex flex-col relative bg-gray-50 dark:bg-brand-bg overflow-hidden transition-colors duration-300">
      
      <!-- Hiệu ứng nền -->
      <div class="absolute inset-0 pointer-events-none">
         <div class="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-brand-purple/5 rounded-full blur-[100px] mix-blend-screen animate-pulse-slow"></div>
         <div class="absolute bottom-[-10%] left-[-10%] w-[400px] h-[400px] bg-blue-600/5 rounded-full blur-[100px] mix-blend-screen animate-pulse-slow"></div>
      </div>

      <!-- A. Welcome -->
      <section id="section-welcome" class="active items-center justify-center h-full text-center p-8 z-10">
        <div class="welcome-message space-y-6 animate-fade-in max-w-md mx-auto bg-white/50 dark:bg-zinc-900/30 backdrop-blur-lg p-10 rounded-3xl border border-white/20 dark:border-zinc-800 shadow-2xl">
           <div class="w-28 h-28 bg-gradient-to-br from-blue-500 to-purple-600 dark:from-brand-purple dark:to-blue-600 rounded-[2rem] mx-auto flex items-center justify-center shadow-2xl shadow-purple-500/30 mb-4 transform rotate-6 hover:rotate-0 transition-all duration-500">
             <i class="fa-solid fa-earth-americas text-6xl text-white"></i>
           </div>
           <h2 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-white dark:to-gray-400 bg-clip-text text-transparent">Evelyn Chat</h2>
           <p class="text-gray-600 dark:text-zinc-400 leading-relaxed">Kết nối không giới hạn. Chọn một cuộc trò chuyện hoặc tìm kiếm bạn bè để bắt đầu.</p>
           <div class="flex justify-center gap-4 pt-4">
              <button onclick="document.querySelector('.menu-buttons button[data-func=\'friends\']').click()" class="px-6 py-2.5 bg-white dark:bg-zinc-800 text-gray-700 dark:text-white rounded-xl text-sm font-bold shadow-lg hover:bg-gray-50 dark:hover:bg-zinc-700 transition-all">Tìm bạn</button>
              <button onclick="document.getElementById('create-group-modal').style.display='flex'" class="px-6 py-2.5 bg-brand-purple text-white rounded-xl text-sm font-bold shadow-lg hover:bg-brand-purpleDark transition-all">Tạo nhóm</button>
           </div>
        </div>
      </section>

      <!-- B. Chat Screen -->
      <section id="section-chat" class="h-full relative flex-col z-10 bg-white/50 dark:bg-brand-bg/50 backdrop-blur-sm" style="display: none;">
        <div class="chat-header h-16 border-b border-gray-200 dark:border-brand-border flex items-center justify-between px-6 bg-white/90 dark:bg-brand-bg/90 backdrop-blur-md sticky top-0 z-20 shadow-sm">
           <div class="flex items-center gap-4 cursor-pointer group" onclick="document.getElementById('chat-avatar').click()">
             <button id="back-btn" class="md:hidden text-gray-500 dark:text-zinc-400"><i class="fa-solid fa-arrow-left"></i></button>
             <div class="relative">
                <img id="chat-avatar" class="w-10 h-10 rounded-full object-cover border border-gray-200 dark:border-brand-border bg-zinc-800" src="" />
                <span id="header-status-dot" class="hidden absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 border-2 border-white dark:border-brand-bg rounded-full online-indicator"></span>
             </div>
             <div>
               <h3 id="chat-name" class="font-bold text-gray-800 dark:text-white text-sm">User</h3>
               <p id="header-status-text" class="text-[11px] text-zinc-500 dark:text-zinc-400 font-medium">Ngoại tuyến</p>
             </div>
           </div>
           <div class="flex gap-4 text-zinc-400">
              <button class="w-8 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-800 flex items-center justify-center transition-all hover:text-brand-purple"><i class="fa-solid fa-phone"></i></button>
              <button class="w-8 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-800 flex items-center justify-center transition-all hover:text-brand-purple"><i class="fa-solid fa-video"></i></button>
              <button class="w-8 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-800 flex items-center justify-center transition-all"><i class="fa-solid fa-ellipsis-vertical"></i></button>
           </div>
        </div>

        <div class="chat-page flex-1 overflow-hidden relative flex flex-col">
           <div id="messages" class="messages flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth"></div>
           <div id="chat-input-wrapper" class="p-4 bg-white dark:bg-brand-bg border-t border-gray-200 dark:border-brand-border transition-all duration-300" style="display:none;">
             <div class="chat-input max-w-4xl mx-auto flex flex-col gap-2">
                <div id="file-preview" class="hidden p-3 bg-gray-50 dark:bg-brand-panel rounded-xl border border-gray-200 dark:border-brand-border flex justify-between items-center shadow-lg">
                   <div id="preview-content" class="text-sm text-gray-600 dark:text-zinc-300 truncate font-medium flex items-center gap-2"></div>
                   <button id="remove-preview-btn" class="w-6 h-6 rounded-full bg-zinc-700 hover:bg-red-500 text-white flex items-center justify-center"><i class="fa-solid fa-xmark text-xs"></i></button>
                </div>
                <div class="flex items-end gap-2 bg-gray-100 dark:bg-brand-input border border-gray-200 dark:border-brand-border p-2 rounded-2xl focus-within:border-blue-500 dark:focus:within:border-brand-purple transition-all shadow-sm">
                   <label for="file-input" class="p-3 text-gray-400 dark:text-zinc-400 hover:text-gray-600 dark:hover:text-white cursor-pointer"><i class="fa-solid fa-paperclip"></i></label>
                   <input id="file-input" type="file" class="hidden" />
                   <textarea id="message-input" placeholder="Nhập tin nhắn..." class="w-full bg-transparent text-gray-800 dark:text-white text-sm px-2 py-3 outline-none resize-none max-h-32 placeholder-gray-500 scrollbar-hide" rows="1"></textarea>
                   <button id="send-btn" class="p-3 bg-brand-purple text-white rounded-xl shadow-lg flex items-center justify-center"><i class="fa-solid fa-paper-plane text-sm"></i></button>
                </div>
             </div>
           </div>
        </div>
      </section>

      <!-- C. Profile Screen -->
      <section id="section-profile" class="h-full overflow-y-auto custom-scrollbar p-4 md:p-8">
         <div class="min-h-full flex flex-col items-center justify-center py-8">
             <div class="w-full max-w-sm bg-white dark:bg-[#121212] border border-gray-200 dark:border-zinc-800 rounded-[30px] overflow-hidden shadow-2xl relative shrink-0">
                <div class="h-32 bg-gradient-to-r from-indigo-900 to-purple-900 relative"></div>
                <div class="absolute top-16 left-1/2 transform -translate-x-1/2">
                     <div class="relative group">
                         <img id="main-profile-avatar-display" src="" class="w-28 h-28 rounded-full object-cover border-4 border-white dark:border-[#121212] bg-zinc-800 shadow-lg">
                         <label for="avatar-upload-input-profile-section" class="absolute bottom-1 right-1 w-9 h-9 bg-zinc-800 hover:bg-brand-purple text-white rounded-full flex items-center justify-center cursor-pointer transition-colors shadow-md border border-white dark:border-[#121212] group-hover:scale-110"><i class="fa-solid fa-camera text-xs"></i></label>
                         <input type="file" id="avatar-upload-input-profile-section" accept="image/*" class="hidden" />
                     </div>
                </div>
                <div class="pt-16 pb-8 px-6 text-center">
                    <h2 id="current-display-name-profile" class="text-3xl font-bold text-gray-900 dark:text-white mb-8 tracking-tight break-words">Loading...</h2>
                    <div class="space-y-3 text-left">
                        <div class="bg-gray-50 dark:bg-[#1e1e1e] p-4 rounded-2xl flex items-center gap-4 border border-gray-200 dark:border-zinc-800/50">
                            <div class="w-10 h-10 rounded-full bg-gray-200 dark:bg-zinc-800 flex items-center justify-center text-gray-500 dark:text-zinc-400 shrink-0"><i class="fa-solid fa-cake-candles"></i></div>
                            <div><p class="text-[10px] text-gray-500 dark:text-zinc-500 uppercase font-bold tracking-wider">Ngày sinh</p><p id="current-birthdate-profile" class="text-gray-800 dark:text-white font-medium text-lg">---</p></div>
                        </div>
                        <div class="bg-gray-50 dark:bg-[#1e1e1e] p-4 rounded-2xl flex items-center gap-4 border border-gray-200 dark:border-zinc-800/50">
                            <div class="w-10 h-10 rounded-full bg-gray-200 dark:bg-zinc-800 flex items-center justify-center text-gray-500 dark:text-zinc-400 shrink-0"><i class="fa-solid fa-venus-mars"></i></div>
                            <div><p class="text-[10px] text-gray-500 dark:text-zinc-500 uppercase font-bold tracking-wider">Giới tính</p><p id="current-gender-profile" class="text-gray-800 dark:text-white font-medium text-lg">---</p></div>
                        </div>
                    </div>
                    <button id="redirect-to-security-settings" class="mt-8 w-full py-4 rounded-2xl bg-brand-purple text-white font-bold text-lg shadow-lg shadow-purple-900/30 hover:bg-[#7c3aed] transition-all transform active:scale-[0.98]">Chỉnh sửa hồ sơ</button>
                </div>
             </div>
             <div class="h-8"></div> 
         </div>
      </section>

      <!-- D. Các màn hình danh sách khác -->
      <section id="section-friends" class="h-full p-6 overflow-y-auto"><h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Danh sách bạn bè</h3><ul id="friend-list-friends" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></ul></section>
      <section id="section-requests" class="h-full p-6 overflow-y-auto"><h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Lời mời kết bạn</h3><ul id="requests-list" class="space-y-3 max-w-3xl mx-auto"></ul></section>
      <section id="section-all-users" class="h-full p-6 overflow-y-auto"><h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">Khám phá cộng đồng</h3><ul id="all-user-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></ul></section>
      
      <!-- ✅ E. NEW: Màn hình Nhóm (Grid) -->
      <section id="section-groups" class="section-display h-full p-6 overflow-y-auto custom-scrollbar hidden">
                <div class="flex justify-between items-center mb-6 sticky top-0 bg-gray-50/90 dark:bg-brand-bg/90 backdrop-blur z-10 py-2">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white">Nhóm của bạn</h3>
                    <button onclick="document.getElementById('create-group-modal').style.display='flex'" class="px-4 py-2 bg-brand-purple text-white text-sm font-bold rounded-lg shadow-lg hover:bg-brand-purpleDark transition-all flex items-center gap-2"><i class="fa-solid fa-plus"></i> Tạo nhóm</button>
                </div>
                <ul id="group-grid-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="col-span-full text-center text-gray-500 mt-10">Chưa tham gia nhóm nào</div>
                </ul>
            </section>

            <section id="section-group-members" class="section-display h-full p-6 overflow-y-auto custom-scrollbar hidden">
                <div class="flex items-center mb-6 sticky top-0 bg-gray-50/90 dark:bg-brand-bg/90 backdrop-blur z-10 py-2">
                   <button id="back-to-group-info-btn" class="text-gray-500 dark:text-zinc-400 mr-4 hover:text-brand-purple transition-colors p-2 rounded-full hover:bg-zinc-100 dark:hover:bg-zinc-800"><i class="fa-solid fa-arrow-left"></i></button>
                   <h3 class="text-xl font-bold text-gray-800 dark:text-white flex-1">Đặt biệt danh trong nhóm</h3>
                </div>
                <ul id="member-nickname-list" class="space-y-2 max-w-3xl mx-auto">
                    <li class="text-center text-gray-500 mt-10">Đang tải danh sách thành viên...</li>
                </ul>
            </section>

      <!-- F. Settings Section -->
      <section id="section-settings" class="h-full p-8 overflow-y-auto">
         <h2 id="settings-title" class="text-2xl font-bold text-gray-800 dark:text-white mb-6 border-b border-gray-200 dark:border-brand-border pb-4">Cài đặt</h2>
         <div class="max-w-3xl space-y-6">
            <div id="settings-status" class="setting-content active bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border p-6 rounded-xl shadow-sm space-y-6">
               <div class="flex items-center justify-between bg-gray-50 dark:bg-zinc-900/50 p-4 rounded-lg border border-gray-100 dark:border-zinc-800"><div class="flex items-center gap-4"><div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-500/10 flex items-center justify-center text-green-600 dark:text-green-500"><i class="fa-solid fa-toggle-on text-xl"></i></div><div><h3 class="font-bold text-gray-800 dark:text-white text-lg">Trạng thái hoạt động</h3><p class="text-sm text-gray-500 dark:text-zinc-400">Hiển thị khi bạn online</p></div></div><label class="switch"><input type="checkbox" id="incoming-status-toggle"><span class="slider round"></span></label></div>
               <div class="flex items-center justify-between bg-gray-50 dark:bg-zinc-900/50 p-4 rounded-lg border border-gray-100 dark:border-zinc-800"><div class="flex items-center gap-4"><div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-brand-purple/10 flex items-center justify-center text-blue-600 dark:text-brand-purple"><i class="fa-solid fa-moon text-xl"></i></div><div><h3 class="font-bold text-gray-800 dark:text-white text-lg">Chế độ tối (Dark Mode)</h3><p class="text-sm text-gray-500 dark:text-zinc-400">Giao diện tối bảo vệ mắt</p></div></div><label class="switch"><input type="checkbox" id="dark-mode-toggle"><span class="slider round"></span></label></div>
            </div>
            <div id="settings-security" class="setting-content hidden-setting-content bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border p-6 rounded-xl shadow-sm">
                <div class="flex items-center gap-4 mb-6"><div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-500/10 flex items-center justify-center text-blue-600 dark:text-blue-500"><i class="fa-solid fa-shield-halved text-xl"></i></div><div><h3 class="font-bold text-gray-800 dark:text-white text-lg">Tài khoản & Bảo mật</h3></div></div>
                <div id="update-form-section" style="display: none;" class="bg-gray-50 dark:bg-zinc-900 p-6 rounded-xl border border-gray-200 dark:border-brand-border space-y-4 mb-6">
                    <h4 class="text-gray-800 dark:text-white font-bold border-b border-gray-200 dark:border-zinc-800 pb-2 mb-2">Cập nhật thông tin</h4>
                    <div><label class="block text-xs text-gray-500 dark:text-zinc-400 mb-1">Nickname</label><input type="text" id="nickname-input-security" class="w-full bg-white dark:bg-brand-input border border-gray-300 dark:border-zinc-700 rounded-lg p-2.5 text-sm text-gray-800 dark:text-white focus:border-brand-purple outline-none"></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs text-gray-500 dark:text-zinc-400 mb-1">Ngày sinh</label><input type="date" id="dob-input" class="w-full bg-white dark:bg-brand-input border border-gray-300 dark:border-zinc-700 rounded-lg p-2.5 text-sm text-gray-800 dark:text-white focus:border-brand-purple outline-none"></div>
                        <div><label class="block text-xs text-gray-500 dark:text-zinc-400 mb-1">Giới tính</label><select id="gender-input" class="w-full bg-white dark:bg-brand-input border border-gray-300 dark:border-zinc-700 rounded-lg p-2.5 text-sm text-gray-800 dark:text-white focus:border-brand-purple outline-none"><option value="male">Nam</option><option value="female">Nữ</option><option value="other">Khác</option></select></div>
                    </div>
                    <div class="flex gap-3 mt-4 pt-4 border-t border-gray-200 dark:border-zinc-800"><button id="update-personal-info-btn" class="flex-1 bg-brand-purple text-white px-4 py-2.5 rounded-lg text-sm font-bold">Lưu thay đổi</button><button id="cancel-update-btn" class="px-6 py-2.5 bg-gray-200 dark:bg-zinc-700 text-gray-800 dark:text-white rounded-lg text-sm font-medium">Hủy</button></div>
                </div>
                <div class="profile-display-area space-y-6">
                   <div class="flex items-center gap-4 p-4 bg-gray-50 dark:bg-zinc-900/50 rounded-xl border border-gray-200 dark:border-zinc-800"><img src="" id="security-profile-avatar" class="w-16 h-16 rounded-full object-cover border-2 border-brand-purple" /><div class="flex-1"><p class="text-gray-500 dark:text-zinc-500 text-xs uppercase tracking-wider mb-1">Nickname</p><p id="current-display-name" class="text-gray-800 dark:text-white font-bold text-lg">---</p></div><button id="edit-personal-info-btn" class="px-4 py-2 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 text-gray-800 dark:text-white rounded-lg text-sm font-medium border border-gray-300 dark:border-zinc-700">Sửa</button></div>
                   <div class="pt-6 mt-2 border-t border-gray-200 dark:border-zinc-800"><h4 class="text-gray-800 dark:text-white font-bold mb-3 text-sm">Bảo mật</h4><button id="open-password-modal-from-settings" class="w-full flex items-center justify-between bg-red-50 hover:bg-red-100 dark:hover:bg-red-500/10 text-red-500 px-4 py-3 rounded-xl text-sm font-medium border border-red-200 dark:border-red-500/20 group"><span><i class="fa-solid fa-key mr-2"></i> Đổi mật khẩu</span><i class="fa-solid fa-chevron-right text-xs opacity-50 group-hover:translate-x-1"></i></button></div>
                   <input type="file" id="avatar-upload-input" class="hidden" />
                </div>
             </div>
             <div id="settings-theme" class="setting-content hidden-setting-content bg-white dark:bg-brand-panel border border-brand-border p-6 rounded-xl"><h3 class="font-bold text-gray-800 dark:text-white mb-4">Giao diện</h3><div class="bg-zinc-900/50 p-4 rounded-lg border border-zinc-800"><p class="text-zinc-400 text-sm mb-4">Tải lên ảnh nền tùy chỉnh.</p><div class="flex gap-3 items-center"><input type="file" id="background-input" accept="image/*" class="block w-full text-sm text-zinc-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-brand-purple file:text-white hover:file:bg-brand-purpleDark cursor-pointer"/><button id="background-upload-btn" class="bg-zinc-700 px-4 py-2 rounded-lg text-sm text-white hover:bg-zinc-600 font-medium transition-colors">Lưu</button></div></div></div>
             <div id="settings-messages" class="setting-content hidden-setting-content bg-white dark:bg-brand-panel border border-brand-border p-6 rounded-xl"><h3 class="font-bold text-gray-800 dark:text-white mb-4">Quản lý tin nhắn</h3><div class="space-y-4"><div><label class="block text-xs text-zinc-500 mb-1">Xóa lịch sử trò chuyện</label><select id="chat-list-for-deletion" class="w-full bg-brand-input p-2.5 rounded-lg border border-zinc-700 text-white text-sm focus:border-brand-purple outline-none"><option>Đang tải danh sách...</option></select></div><button id="delete-history-btn" class="w-full bg-red-600/20 text-red-500 border border-red-600/30 px-4 py-2.5 rounded-lg text-sm font-medium hover:bg-red-600/30 transition-colors flex items-center justify-center gap-2" disabled><i class="fa-solid fa-trash-can"></i> Xóa vĩnh viễn</button></div></div>
         </div>
      </section>
    </main>

    <!-- Right Sidebar -->
    <aside id="chat-profile" class="chat-profile w-0 overflow-hidden bg-white dark:bg-brand-panel border-l border-gray-200 dark:border-brand-border transition-all duration-300 flex-shrink-0 flex flex-col z-20 absolute right-0 top-0 bottom-0 md:relative">
            <div class="p-6 flex flex-col items-center text-center h-full relative">
                <button id="close-profile-btn" class="absolute top-4 right-4 text-gray-400 dark:text-zinc-400 hover:text-black dark:hover:text-white transition-colors" aria-label="Đóng"><i class="fa-solid fa-xmark text-lg"></i></button>
                <div class="mt-10 mb-6 relative">
                    <img id="profile-avatar-preview" class="w-24 h-24 rounded-full object-cover border-4 border-white dark:border-brand-bg shadow-xl bg-zinc-800" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Profile Preview"/>
                    </div>
                <h3 id="profile-name" class="text-xl font-bold text-gray-800 dark:text-white mb-1">User Name</h3>
                
                <div id="profile-actions" class="w-full space-y-3 mt-6">
                    </div>
                
            </div>
        </aside>
  </div>

  <!-- ✅ MODAL TẠO NHÓM CHAT (ĐÃ SỬA DANH SÁCH) -->
  <div id="create-group-modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center" style="display:none;">
    <div class="bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border rounded-2xl p-6 w-full max-w-sm shadow-2xl transform transition-all scale-100 animate-fade-in flex flex-col max-h-[85vh]">
       <div class="text-center mb-4">
           <div class="w-12 h-12 bg-brand-purple/10 text-brand-purple rounded-full flex items-center justify-center mx-auto mb-3">
               <i class="fa-solid fa-users text-xl"></i>
           </div>
           <h3 class="text-xl font-bold text-gray-800 dark:text-white">Tạo nhóm mới</h3>
           <p class="text-sm text-gray-500 dark:text-zinc-400 mt-1">Đặt tên và thêm thành viên.</p>
       </div>
       
       <div class="space-y-4 flex-1 overflow-hidden flex flex-col">
          <div>
              <label class="block text-xs text-gray-500 dark:text-zinc-400 mb-1.5 font-medium uppercase tracking-wider">Tên nhóm</label>
              <input type="text" id="group-name-input" placeholder="Ví dụ: Hội ăn vặt..." class="w-full bg-gray-50 dark:bg-brand-input border border-gray-300 dark:border-zinc-700 rounded-xl px-4 py-3 text-sm text-gray-800 dark:text-white focus:border-brand-purple outline-none transition-colors">
          </div>
          
          <div class="flex-1 flex flex-col min-h-0">
              <label class="block text-xs text-gray-500 dark:text-zinc-400 mb-1.5 font-medium uppercase tracking-wider">Chọn thành viên</label>
              <div id="create-group-friend-list" class="flex-1 overflow-y-auto custom-scrollbar bg-gray-50 dark:bg-zinc-900/50 rounded-xl p-2 border border-gray-200 dark:border-zinc-800 space-y-1">
                  <!-- Danh sách bạn bè sẽ được JS render vào đây -->
              </div>
          </div>
       </div>

       <div class="flex gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-zinc-800">
          <button id="confirm-create-group-btn" class="flex-1 bg-brand-purple hover:bg-brand-purpleDark text-white py-2.5 rounded-xl text-sm font-bold shadow-lg transition-transform transform active:scale-95">Tạo ngay</button>
          <button id="cancel-group-modal-btn" class="flex-1 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 text-gray-800 dark:text-zinc-300 py-2.5 rounded-xl text-sm font-medium transition-colors">Hủy</button>
       </div>
    </div>
 </div>

  <!-- ✅ MODAL THÊM THÀNH VIÊN -->
  <div id="add-member-modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center" style="display:none;">
    <div class="bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border rounded-2xl p-6 w-full max-w-sm shadow-2xl transform transition-all scale-100 animate-fade-in flex flex-col max-h-[80vh]">
       <div class="text-center mb-4">
           <h3 class="text-xl font-bold text-gray-800 dark:text-white">Thêm thành viên</h3>
           <p class="text-sm text-gray-500 dark:text-zinc-400">Chọn bạn bè để thêm vào nhóm.</p>
       </div>
       <div id="add-member-list" class="flex-1 overflow-y-auto space-y-2 mb-4 custom-scrollbar">
       </div>
       <button onclick="document.getElementById('add-member-modal').style.display='none'" class="w-full bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 text-gray-800 dark:text-zinc-300 py-3 rounded-xl text-sm font-medium transition-colors">Đóng</button>
    </div>
 </div>
 <div id="set-nickname-modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center hidden" style="display:none;">
        <div class="bg-white dark:bg-brand-panel border border-gray-200 dark:border-brand-border rounded-2xl p-6 w-full max-w-xs shadow-2xl transform transition-all scale-100 animate-fade-in">
           <div class="text-center mb-4">
               <div class="w-12 h-12 bg-blue-500/10 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
                   <i class="fa-solid fa-user-tag text-xl"></i>
               </div>
               <h3 class="text-xl font-bold text-gray-800 dark:text-white">Đặt biệt danh</h3>
               <p id="nickname-modal-subtitle" class="text-sm text-gray-500 dark:text-zinc-400 mt-1">Biệt danh cho **User**</p>
           </div>
           
           <div class="space-y-4">
              <div>
                  <label class="block text-xs text-gray-500 dark:text-zinc-400 mb-1.5 font-medium uppercase tracking-wider">Biệt danh mới</label>
                  <input type="text" id="new-nickname-input" placeholder="Nhập biệt danh..." class="w-full bg-gray-50 dark:bg-brand-input border border-gray-300 dark:border-zinc-700 rounded-xl px-4 py-3 text-sm text-gray-800 dark:text-white focus:border-brand-purple outline-none transition-colors">
                  <p class="text-[10px] text-zinc-500 mt-1 italic">* Để trống để xóa biệt danh</p>
                  <input type="hidden" id="nickname-target-group-id" value="">
                  <input type="hidden" id="nickname-target-member-id" value="">
              </div>
           </div>

           <div class="flex gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-zinc-800">
              <button id="confirm-set-nickname-btn" class="flex-1 bg-brand-purple hover:bg-brand-purpleDark text-white py-2.5 rounded-xl text-sm font-bold shadow-lg transition-transform transform active:scale-95">Xác nhận</button>
              <button onclick="document.getElementById('set-nickname-modal').style.display='none'" class="flex-1 bg-gray-200 dark:bg-zinc-800 hover:bg-gray-300 dark:hover:bg-zinc-700 text-gray-800 dark:text-zinc-300 py-2.5 rounded-xl text-sm font-medium transition-colors">Hủy</button>
           </div>
        </div>
    </div>
 

  <!-- Modals Khác -->
  <div id="password-modal" class="fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center" style="display:none;">
     <!-- ... -->
  </div>
  <div id="password-popup" class="fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center" style="display:none;">
    <!-- ... -->
  </div>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/chat/js/utils.js"></script>
  <script src="/chat/js/templates.js"></script>
  <!-- <script src="/chat/js/main.js"></script> -->
   <script src="/chat/js/main/profile.js"></script>
   <script src="/chat/js/main/core.js"></script>
   <script src="/chat/js/main/chat.js"></script>
   <script src="/chat/js/main/social.js"></script>
  
  <script>
    const chatProfile = document.getElementById('chat-profile');
    document.getElementById('close-profile-btn')?.addEventListener('click', () => {
        chatProfile.style.width = '0px';
        chatProfile.classList.remove('border-l');
    });
  </script>
</body>
</html>